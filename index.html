<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="referrer" content="no-referrer">
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>@CRICMATCHSTREAM</title>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" rel="stylesheet">
  <style>
    html, body {box-sizing: border-box;height: 100%;margin: 0;padding: 0;overflow: hidden;width: 100%;}
    *, ::after, ::before {box-sizing: inherit;}
    body {height: 100%;line-height: 1;margin: 0;outline: 0;overflow: hidden;padding: 12px;background: none;}
    .video-container {align-items: center;display: flex;height: 100%;justify-content: center;margin-bottom: 0;overflow: hidden;padding: 0;position: relative;width: 100%;background: none;box-shadow: none;border-radius: 0;}
    #video {position: absolute;top: 0;left: 0;width: 100%;height: 100%;object-fit: contain;border-radius: 0;}
    img {position: absolute;top: 10px;left: 15px;height: auto;max-width: 115px;width: 100%;max-height: 25px;transition: opacity 1s ease;}
    @media (min-width: 1024px) {.video-container {height: 94vh;}#video {height: 100%;width: 100%;object-fit: fill;}}
    @media (max-width: 1023px) {.video-container {padding-bottom: 56.25%;min-height: 100%;}#video {object-fit: contain;}}
    @media (max-width: 767px) {img {max-width: 90px;max-height: 20px;left: 5px;top: 5px;}.shaka-overlay .shaka-controls .shaka-control-button.shaka-button-overflow-menu {transform: scale(0.7);}.shaka-overlay .shaka-controls {padding: 5px;}}
    @media (orientation: landscape) {.video-container {height: 100vh;padding-bottom: 0;}#video {object-fit: fill;}}
    .shaka-overflow-menu, .shaka-settings-menu {background-color: rgba(255, 0, 120, 0.9);}
    .shaka-current-selection-span, .shaka-settings-menu button {color: #0fc;font-weight: 700;}
    .shaka-overflow-menu button:hover, .shaka-settings-menu button:hover {background-color: #000;}
    .shaka-overflow-button-label {color: #ffffe6;font-weight: 700;}
    .material-icons-round {color: #e6e6e6;}
    .shaka-spinner-container {display: none !important;}
  </style>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous" defer></script>
</head>

<body>
  <center>
    <div class="video-container" data-shaka-player-container>
      <video autoplay playsinline data-shaka-player id="video" muted poster="https://i.postimg.cc/QCytSSbY/20251010-100543.jpg" preload="auto"></video>
    </div>
  </center>

  <script>
    // Correct, explicit Shaka Player + UI initialization.
    async function initApp() {
      // Install shaka polyfills (safe to call even if already installed)
      shaka.polyfill.installAll();

      if (!shaka.Player.isBrowserSupported()) {
        console.error('Shaka Player is not supported in this browser.');
        return;
      }

      const video = document.getElementById('video');
      const container = document.querySelector('[data-shaka-player-container]');

      // Create player and UI overlay explicitly (this avoids relying on undocumented auto-events)
      const player = new shaka.Player(video);
      const ui = new shaka.ui.Overlay(player, video, container);

      // expose to window for debugging
      window.player = player;
      window.ui = ui;

      // configure UI appearance & controls
      ui.configure({
        controlPanelElements: ["play_pause","mute","volume","spacer","time_and_duration","picture_in_picture","fullscreen","overflow_menu"],
        volumeBarColors: { base: "rgba(255, 0, 150, 0.7)", level: "rgba(0, 204, 255, 0.7)" },
        seekBarColors: { base: "rgba(0, 204, 255, 0.7)", buffered: "rgba(255, 0, 150, 0.7)", played: "rgba(0, 204, 255, 0.7)" }
      });

      // configure player (DRM clearKeys example preserved from original)
      player.configure({
        drm: {
          clearKeys: {
            "ed76c18710d621a87c89dedc7c13019f": "7241c82fe48525a9dc6be6d7bb86611f"
          }
        }
      });

      // Add error listeners
      player.addEventListener('error', onPlayerErrorEvent);
      try {
        ui.getControls().addEventListener('error', onUIErrorEvent);
      } catch (e) {
        // ui.getControls() may not be available in some older builds — ignore safely
        console.warn('UI controls error listener could not be attached:', e);
      }

      // Load the manifest (keep your original URL)
      try {
        await player.load('https://otte.live.fly.ww.aiv-cdn.net/bom-nitro/live/dash/enc/urvst7sxzy/out/v1/e21d21ec21e34c7192049a44ee3de428/cenc.mpd');
        console.log('Manifest loaded successfully');
      } catch (err) {
        onPlayerError(err);
      }
    }

    function onPlayerErrorEvent(event) {
      // event.detail is a shaka.util.Error object
      onPlayerError(event.detail || event);
    }

    function onUIErrorEvent(event) {
      onPlayerError(event.detail || event);
    }

    function onPlayerError(err) {
      // Generic error handler — logs to console so you can debug.
      console.error('Shaka Player error:', err);
    }

    // Initialize after DOM is ready and shaka-player UI lib has loaded
    document.addEventListener('DOMContentLoaded', initApp);

    // Telegram prompt moved to run after page load to avoid blocking init
    document.addEventListener('DOMContentLoaded', function () {
      setTimeout(function () {
        const message = "JOIN OUR TELEGRAM CHANNEL FOR MORE LIVE STREAM LINKS";
        if (confirm(message)) {
          window.location.href = "https://t.me/cricmatchstream";
        }
      }, 600);
    });

    // Optional helper referenced in original file
    function welcome() {
      window.open('https://t.me/cricmatchstream', '_blank');
    }
  </script>
</body>
</html>
